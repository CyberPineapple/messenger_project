# Чат

При создании чата перед пользователем предъявляются следующие требования:

* длина имени чата не должна превышать 32 символов;
* пользователь должен быть авторизован в системе.

## Создание
Для создания чата клиент должен отправить json-запрос с следущим содержанием

```json
{
	"Type": "chat",
	"Command": "create",
	"Chat": "general"
}
```

При успешном создании чата сервер ответит

```json
{
	"Type": "chat",
	"Status": "success"
}
```

Если не авторизованный пользователь попробует создать чат, сервер ответит ему так

```json
{
	"Type": "login",
	"Status": "error"
}
```

### Создание чата с паролем

Для создания чата с паролем необходимо добавить еще одно поле Password, для установки пароля.

```json
{
	"Type": "chat",
	"Command": "create",
	"Chat": "general secret",
	"Password": "secret"
}
```
При успешном создании чата с паролем сервер ответит

```json
{
	"Type": "chat",
	"Status": "success"

}
```

Если пользователь попытается создат чат с уже имеющимся названием в базе, сервер ответит

```json
{
	"Type": "chat",
	"Status": "chat exist"
}
```

## Удаление чата
Для удаления чата необходимы следующие условия условие

* пользователь должнен быть создателем чата
* пользователь должен выбрать чат *("Command": "choice")*

Удаление чата **с паролем** и **без** приходит **без изменений**

Для удаления пользователь должен отправить следующий json запрос

```json
{
	"Type": "chat",
	"Command": "delete"
}
```

При успешном запросе сервер ответит

```json
{
	"Type": "chat",
	"Command": "delete",
	"Status": "success"
}
```

Важно, что после удаления чата, все пользователи удаленного чата будут перенапралены в чат **general**

Если пользователь не имеющий право(условия описаны выше) удалять, попытается удалить, сервер ответит так

```json
{
	"Type": "chat",
	"Command": "delete",
	"Status": "error"
}
```



## Получить список чатов
Для получения всех чатов клиент должен отправить

```json
{
	"Type": "chat",
	"Command": "list"
}
```

Сервер ответит

```json
{
	"Type": "chat",
	"Chats": [
	{
		"Chat": "general",
		"Closed": false
	},
	{
		"Chat": "secret general",
		"Closed": true
	}
 ]
}
```

В поле Chats **все** чаты системы. В поле Chat находится имя чата, поле Closed - признак чата под паролем чата. True - пароль есть.

Если не авторизованный пользователь попытается получить чаты, то сервер ответит

```json
{
	"Type": "login",
	"Status": "error"
}
```

## Вход в чат без пароля

По умолчанию, после авторизации пользователь оказывется в чате general, для входа в чат клиенту нужно отправить

```json
{
	"Type": "chat",
	"Chat": "general",
	"Command": "choice"
}
```

Сервер ответит

```json
{
	"Type": "chat",
	"Command": "choice",
	"Messages": [
	{
		"user": "user",
		"text": "Hello from past",
		"date": "1970-01-03 03:59:00"
	},
	{
		"user": "user",
		"text": "Hey, there is somebody?",
		"date": "2019-05-04 20:00:00"
	}
 ]
}
```
Где **Messages** это массив с json объектам.

### Вход в чат под паролем

По умолчанию, после авторизации пользователь оказывется в чате general, для входа в чат с паролем клиенту нужно отправить серверу

```json
{
	"Type": "chat",
	"Command": "choice",
	"Chat": "secret general",
	"Password": "secret"
}
```

При вверно введеном пароле сервер ответит

```json
{
	"Type": "chat",
	"Messages": [
	{
		"user": "user",
		"text": "Встретимся на остановке",
		"date": "2019-01-01 03:59:00"
	}
 ]
}
```

Где **Messages** это массив с json объектам.

Если пользователь захочет посмотреть одим глазком в закрытый чат, не имея пароля

```json
{
	"Type":"chat",
	"Command":"choice",
	"Chat":"secret general"
}
```

Сервер лишь помахает пальцем

```json
{
	"Type": "chat",
	"Status": "access denied"
}
```

Или пользователь забыл пароль

```json
{
	"Type":"chat",
	"Command":"choice",
	"Chat":"secret general",
	"Password": "terces"
}
```

Сервер ответит аналогично

```json
{
	"Type": "chat",
	"Status": "access denied"
}
```

## Получить предыдущие сообщения

По умолчанию сервер отдает последние 30 сообщений, чтобы избежать нагрузки на сервер.

Если клиенту нужно получить раннее отправленные сообщения, то нужно отправить

```json
{
	"Type": "chat",
	"Command": "earlier"
}
```

На что сервер ответит массивом из 15 или меньше сообщений.

```json
{
	"Type": "chat",
	"Command": "earlier",
	"Messages": [
	{
		"user": "login",
		"text": "Hello from past",
		"date": "1970-01-03 03:59:00"
	},
	{
		"user": "user",
		"text": "Hey, there is somebody?",
		"date": "2019-05-04 20:00:00"
	}
 ]
}
```

Если клиент достиг начала переписки, сервер отправит

```json
{
	"Type": "chat",
	"Command": "earlier",
	"Messages": []
}
```